# 不动产盖章算子

## 功能说明

本算子给不动产查询结果图片添加逼真印章，支持多种效果（旋转、透明度、磨损、模糊、渐变）。

## 输入参数

| 参数名            | 类型        | 默认值  | 说明                                                           |
| ----------------- | ----------- | ------- | -------------------------------------------------------------- |
| size              | inputNumber | 420     | 印章大小（像素），范围 300-600                                 |
| color             | input       | 190,0,0 | 印章颜色（RGB 格式）                                           |
| opacity           | slider      | 0.85    | 印章透明度（0-1），范围 0.5-1.0                                |
| rotationMin       | inputNumber | -5      | 旋转角度最小值（度），范围 -180 到 180                         |
| rotationMax       | inputNumber | 5       | 旋转角度最大值（度），范围 0 到 180                            |
| wearIntensity     | slider      | 0.15    | 磨损强度（0-1），范围 0-05 到 0.5                              |
| addBlur           | switch      | false   | 是否添加轻微模糊效果                                           |
| gradientDirection | select      | 无      | 渐变方向（无渐变、左深右浅、右深左浅、上深下浅、下深上浅）     |
| textMargin        | inputNumber | 30      | 文字离内圈的距离（像素），范围 0-100                           |
| circleWidth       | inputNumber | 4       | 印章外圈线条粗细（像素），范围 1-10                            |
| starRadiusRatio   | inputNumber | 12      | 五角星半径比例（size/12），范围 5-20                           |
| fontSizeRatio     | inputNumber | 5       | 字体大小比例（size/5），范围 3-10                              |
| charSpacing       | inputNumber | 1.0     | 字间距系数（1.0=正常，<1.0=更紧凑，>1.0=更稀疏），范围 0.5-2.0 |
| fontName          | select      | 无      | 字体名称（simhei=黑体，simsun=宋体，simkai=楷体），默认黑体    |
| fontBold          | switch      | false   | 是否使用加粗字体，默认 false                                   |

## 输入格式

算子期望输入为：

- `filePath`: 图片路径列表（从上一步 Word 转图片算子输出）
- `text`: JSON 格式的不动产数据（用于获取省份信息）

## 输出格式

算子输出为盖章后的图片路径列表，存储在 `sample['filePath']` 字段中。

- 如果输入有多张图片，输出对应数量的盖章后图片路径
- 每张图片根据对应的数据索引获取省份信息进行盖章

## 印章效果说明

### 基础效果

- **印章大小**：控制印章的尺寸（像素）
- **印章颜色**：RGB 格式，默认鲜红色 (190, 0, 0)
- **透明度**：控制印章的透明程度（0=完全透明，1=完全不透明）
- **旋转**：印章随机旋转一定角度（可设置范围）

### 高级效果

- **磨损强度**：模拟印章使用后的磨损效果（噪点和渐变）
- **模糊**：添加轻微高斯模糊效果
- **渐变方向**：模拟印章油墨不均匀的渐变效果
    - 左深右浅：左侧深，右侧浅
    - 右深左浅：右侧深，左侧浅
    - 上深下浅：上侧深，下侧浅
    - 下深上浅：下侧深，上侧浅

### 字体效果

- **文字边距**：控制文字离内圈的距离
- **圆线宽度**：印章外圈线条粗细
- **五角星比例**：控制五角星的大小
- **字体大小比例**：控制字体大小
- **字间距**：控制文字的紧凑程度
- **字体选择**：支持黑体、宋体、楷体
- **字体加粗**：支持加粗字体效果

## 注意事项

1. **依赖库**：需要安装 `numpy`, `Pillow`
2. **字体要求**：需要系统中文字体文件，算子会自动检测常见字体路径
3. **随机效果**：每次盖章会随机生成不同的效果参数，使每张图片的印章略有不同
4. **临时文件**：盖章过程中使用 `/tmp/property_seal` 目录存放临时文件
5. **省份匹配**：根据 JSON 数据中的省份信息匹配，如果无法匹配则使用默认"河北省"

## 使用场景

适用于需要给不动产查询结果图片添加印章的场景，如：

- 数据标注训练
- 文档生成流程测试
- 模拟真实盖章效果

## 输出示例

```json
{
    "filePath": [
        "/tmp/property_seal/不动产查询表_001.jpg",
        "/tmp/property_seal/不动产查询表_002.jpg"
    ]
}
```
